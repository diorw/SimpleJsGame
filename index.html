<!doctype html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css" href="css/reset.css">
<link rel="stylesheet"  type="text/css" href="css/style.css">
<script src="js/modernizr.js"></script>
<script src="js/jquery-2.1.4.js"></script>
<script src="js/bootstrap_min.js"></script>
<script language="javascript">
var DB = function( db_name, size ){
     var _db = openDatabase(db_name, '1.0.0','', size );

     return {

         /**
          * 执行sql，回调返回影响条数
          */
         execute:function( sql, param, callback ) {
             //参数处理
            if( !param ){
                param = [];
            }else if(typeof param == 'function' ){
                callback = param;
                param = [];
            }

             this.query( sql, param, function(result){
                 if( typeof callback == 'function' ){
                     callback(result.rowsAffected);
                 }
             });
         },

         /**
          * 执行sql，回调返回sql查询对象
          * 查询时，有数据返回数组，无数据返回0
          * 增删改时：返回int，影响条数
          * void query( string[, function])
          * void query( string[, array[, function]])
          */
         query:function(sql, param, callback){
            //参数处理
            if( !param ){
                param = [];
            }else if(typeof param == 'function' ){
                callback = param;
                param = [];
            }

            var self=this;
            //只有一个参数
            _db.transaction(function (tx) {
                //4个参数：sql，替换sql中问号的数组，成功回调，出错回调
                tx.executeSql(sql,param,function(tx,result){
                    if (typeof callback == 'function' ){
                        callback(result);
                    }
                },self.onfail) ;
            })
        },
        /**
         * 插入，回调返回last id
         * void insert( string, object[, function])
         */
        insert:function( table, data, callback ){
            if( typeof data != 'object' && typeof callback == 'function' ){
                callback(0);
            }

            var k=[];
            var v=[];
            var param=[];
            for(var i in data ){
                k.push(i);
                v.push('?');
                param.push(data[i]);
            }
            var sql="INSERT INTO "+table+"("+k.join(',')+")VALUES("+v.join(',')+")";

            this.query(sql, param, function(result){
                if ( typeof callback == 'function' ){
                    callback(result.insertId);
                }
            });
        },
        /**
         * 修改，回调返回影响条数
         * void update( string, object[, string[, function]])
         * void update( string, object[, string[, array[, function]]])
         */
        update:function( table, data, where, param, callback ){
            //参数处理
            if( !param ){
                param = [];
            }else if(typeof param == 'function' ){
                callback = param;
                param = [];
            }

            var set_info = this.mkWhere(data);
            for(var i=set_info.param.length-1;i>=0; i--){
                param.unshift(set_info.param[i]);
            }
            var sql = "UPDATE "+table+" SET "+set_info.sql;
            if( where ){
                sql += " WHERE "+where;
            }

            this.query(sql, param, function(result){
                if( typeof callback == 'function' ){
                    callback(result.rowsAffected);
                }
            });
        },

        /**
         * 删除
         * void toDelete( string, string[, function]])
         * void toDelete( string, string[, array[, function]])
         */
        toDelete:function( table, where, param, callback ){
            //参数处理
            if( !param ){
                param = [];
            }else if(typeof param == 'function' ){
                callback = param;
                param = [];
            }

            var sql = "DELETE FROM "+table+" WHERE "+where;
            this.query(sql, param, function(result){
                if( typeof callback == 'function' ){
                    callback(result.rowsAffected);
                }
            });
        },

        /**
         * 查询，回调返回结果集数组
         * void fetch_all( string[, function] )
         * void fetch_all( string[, param[, function]] )
         */
        fetchAll:function( sql, param, callback ){
            //参数处理
            if( !param ){
                param = [];
            }else if(typeof param == 'function' ){
                callback = param;
                param = [];
            }

            this.query( sql, param, function(result){
                if (typeof callback == 'function' ){
                    var out=[];

                    if (result.rows.length){
                        for (var i=0;i<result.rows.length;i++){
                            out.push(result.rows.item(i));
                        }
                    }

                    callback(out);
                }
            });
        },

        /**
         * 查询表的信息
         * table_name: 表名称，支持 % *，
         */
        showTables:function( table_name, callback){
            this.fetchAll("select * from sqlite_master where type='table' and name like ?", [table_name], callback);
        },


        /**
         * 组装查询条件
         */
        mkWhere:function(data){
            var arr=[];
            var param=[];
            if( typeof data === 'object' ){
                for (var i in data){
                    arr.push(i+"=?");
                    param.push(data[i]);
                console.log('data.i:'+i);
                }
            }
            return {sql:arr.join(' AND '),param:param};
        },

        /**
         * 错误处理
         */
        onfail:function(tx,e){
            console.log('sql error: '+e.message);
        }
     }
}
var db = new DB('C:\\Users\\wda\\final.db',1024*1024*2);
//db.toDelete("rank","1==1");
//db.fetchAll('select * from rank',function(ret){console.log(ret)});
//db.query("CREATE TABLE rank (ids int primary key ,name text not null,rows int not null,times int not null)");
//db.insert("rank",{name:'wda',rows:3,times:9});
//db.showTables("rank",function(ret){console.log(ret)});



	  var s;
    function buildBoard(size) {
		s=size;
      	var str = "<TABLE border=4 align='center' width=400 height=400>"
      	for (var x=0; x < size; x++) {
        	str+="<TR>"
        	for (var y=0; y < size; y++) {
				        str+="<td id="+x+""+y+" onclick='td(this.id)'  style='background:white'>&nbsp;</TD>"
        	}
        	str+="</TR>"
      	}
      	str+="</TABLE>"
	  	return str;
    }


	function setTdColor(id,color){
		document.getElementById(id).style.background=color;
	}


	function returnColor(id){
		var tdColor=document.getElementById(id).style.background;
		return tdColor;

	}


	function idflag(id){
		var iid=parseInt(id);
		var shi=parseInt(iid/10);
		var ge=iid%10;

		if(shi==0||shi==b||ge==0||ge==b){
			return true;
		}
		else{
			return false;
		}
	}


	var b;
	function setColor(id,col){
		b=(s-1);

		if(id=="0"+b||id==b+"0"||id==b+""+b||id=="00"){
			document.getElementById(id).style.background=col;
			if(id=='00'){
				var ids=new Array(2);
				ids[0]='01';
				ids[1]='10';
				var c=new Array(2);
				c[0]=returnColor(ids[0]);
				c[1]=returnColor(ids[1]);
				setTdColor(ids[0],col);
				setTdColor(ids[1],col);
				for(var k=0;k<2;k++){
					if(c[k]=="red"){
						setTdColor(ids[k],'white');
					}else{
						setTdColor(ids[k],'red');
					}
				}
			}
			if(id==b+'0'){
				var ids=new Array(2);
				ids[0]=(b-1)+'0';
				ids[1]=b+'1';
				var c=new Array(2);
				c[0]=returnColor(ids[0]);
				c[1]=returnColor(ids[1]);
				setTdColor(ids[0],col);
				setTdColor(ids[1],col);
				for(var k=0;k<2;k++){
					if(c[k]=="red"){
						setTdColor(ids[k],'white');
					}else{
						setTdColor(ids[k],'red');
					}
				}
			}
			if(id=='0'+b){
				var ids=new Array(2);
				ids[0]='0'+(b-1);
				ids[1]='1'+b;
				var c=new Array(2);
				c[0]=returnColor(ids[0]);
				c[1]=returnColor(ids[1]);
				setTdColor(ids[0],col);
				setTdColor(ids[1],col);
				for(var k=0;k<2;k++){
					if(c[k]=="red"){
						setTdColor(ids[k],'white');
					}else{
						setTdColor(ids[k],'red');
					}
				}
			}
			if(id==b+''+b){
				var ids=new Array(2);
				ids[0]=(b-1)+''+b;
				ids[1]=b+''+(b-1);
				var c=new Array(2);
				c[0]=returnColor(ids[0]);
				c[1]=returnColor(ids[1]);
				setTdColor(ids[0],col);
				setTdColor(ids[1],col);
				for(var k=0;k<2;k++){
					if(c[k]=="red"){
						setTdColor(ids[k],'white');
					}else{
						setTdColor(ids[k],'red');
					}
				}
			}
		}



		else if(idflag(id)){
				for(var j=0;j<s;j++){
					if(id=='0'+j){
						var ids=new Array(3);
						ids[0]='0'+(j-1);
						ids[1]='0'+(j+1);
						ids[2]='1'+j;
						var c=new Array(3);
						c[0]=returnColor(ids[0]);
						c[1]=returnColor(ids[1]);
						c[2]=returnColor(ids[2]);
						setTdColor(id,col);
						setTdColor(ids[0],col);
						setTdColor(ids[1],col);
						setTdColor(ids[2],col);
						for(var k=0;k<3;k++){
							if(c[k]=="red"){
								setTdColor(ids[k],'white');
							}else{
								setTdColor(ids[k],'red');
							}
						}
					}
					if(id==b+''+j){
						var ids=new Array(3);
						ids[0]=b+''+(j-1);
						ids[1]=b+''+(j+1);
						ids[2]=(b-1)+''+j;
						var c=new Array(3);
						c[0]=returnColor(ids[0]);
						c[1]=returnColor(ids[1]);
						c[2]=returnColor(ids[2]);
						setTdColor(id,col);
						setTdColor(ids[0],col);
						setTdColor(ids[1],col);
						setTdColor(ids[2],col);
						for(var k=0;k<3;k++){
							if(c[k]=="red"){
								setTdColor(ids[k],'white');
							}else{
								setTdColor(ids[k],'red');
							}
						}
					}
					if(id==j+'0'){
						var ids=new Array(3);
						ids[0]=(j-1)+'0';
						ids[1]=(j+1)+'0';
						ids[2]=j+'1';
						var c=new Array(3);
						c[0]=returnColor(ids[0]);
						c[1]=returnColor(ids[1]);
						c[2]=returnColor(ids[2]);
						setTdColor(id,col);
						setTdColor(ids[0],col);
						setTdColor(ids[1],col);
						setTdColor(ids[2],col);
						for(var k=0;k<3;k++){
							if(c[k]=="red"){
								setTdColor(ids[k],'white');
							}else{
								setTdColor(ids[k],'red');
							}
						}
					}
					if(id==j+''+b){

						var ids=new Array(3);
						ids[0]=(j-1)+''+b;
						ids[1]=(j+1)+''+b;
						ids[2]=j+''+(b-1);
						var c=new Array(3);
						c[0]=returnColor(ids[0]);
						c[1]=returnColor(ids[1]);
						c[2]=returnColor(ids[2]);
						setTdColor(id,col);
						setTdColor(ids[0],col);
						setTdColor(ids[1],col);
						setTdColor(ids[2],col);
						for(var k=0;k<3;k++){
							if(c[k]=="red"){
								setTdColor(ids[k],'white');
							}else{
								setTdColor(ids[k],'red');
							}
						}
				}
			}
		}



		else{
			for(var i=1;i<b;i++){
				for(var j=1;j<b;j++){
					if(id==i+""+j){
						var id1=new Array(4);
						id1[0]=(i+1)+""+j;
						id1[1]=(i-1)+""+j;
						id1[2]=i+""+(j+1);
						id1[3]=i+""+(j-1);
						var c=new Array(4);
						c[0]=returnColor(id1[0]);
						c[1]=returnColor(id1[1]);
						c[2]=returnColor(id1[2]);
						c[3]=returnColor(id1[3]);
						setTdColor(id,col);
						setTdColor(id1[0],col);
						setTdColor(id1[1],col);
						setTdColor(id1[2],col);
						setTdColor(id1[3],col);
						for(var k=0;k<4;k++){
							if(c[k]=="red"){
								setTdColor(id1[k],'white');
							}else{
								setTdColor(id1[k],'red');
							}
						}

					}
				}

			}
		}
	}


	var sum;
	var lian;
	var bu;
	function td(id){
		var name= document.getElementById("name").value;
		var t=document.getElementById(id);
		if(t.style.background=="white"){
			setColor(id,'red');
		}
		else{
			setColor(id,'white');
		}


		sum++;
		lian=0;
		bu=0;
		var value=parseInt(document.getElementById('size').value);
		for(var i=0;i<value;i++){
			for(var j=0;j<value;j++){
				var dd=document.getElementById(i+''+j).style.background;
				if(dd=='red'){
					lian++;
				}else{
					bu++;
				}
			}
		}
		if(lian==count){
			document.getElementById('tb').innerHTML="<font size=7 color='red'>成功</font>"
      //db.fetchAll('select * from rank',function(ret){console.log(ret)});
      var name =   document.getElementById('name').value;
      var size =   document.getElementById('size').value;
      var id;
      document.getElementById('subname').value = name;
      document.getElementById('subrows').value = size;
      document.getElementById('subtimes').value = sum;
      db.fetchAll('select * from rank',function(ret){
        id = ret.length+1;

        db.insert("rank",{ids:id,name:name,rows:size,times:sum});
      });
    //  var ids = parseInt(id);


    //  loadall();

		}
		document.getElementById('sum').innerHTML=sum;
		document.getElementById('lian').innerHTML=lian;
		document.getElementById('bu').innerHTML=bu;
	  document.getElementById('name').innerHTML=name;

	}
	var count;
	function init(){
		sum=0;
		var value=document.getElementById('size').value;
		var name = document.getElementById('name').value;
		count=parseInt(value)*parseInt(value);
		document.getElementById("count").innerHTML=count;
		document.getElementById("sum").innerHTML=0;
		document.getElementById("bu").innerHTML=count;
		document.getElementById("lian").innerHTML=0;
		document.getElementById("tb").innerHTML=buildBoard(value);
		document.getElementById("name").innerHTML=name;
	}
  function loadall(){
    var list = document.getElementById("list");
  //  var db = new DB('C:\\Users\\wda\\final.db',1024*1024*2);
    var name = document.getElementById('name').value;
    var sql = 'select * from rank';
    if(document.getElementById("onlyme").checked==true){
      sql+= " where name == \'"+name+"\'";
    }
    if(document.getElementById("sort_by_times").checked==true){
      sql+=" order by times";
    }else{
      sql+=" order by rows";
    }
  //  console.log(sql);
    db.fetchAll(sql,function(ret){
      console.log(ret.length);
      if(ret.length>=0){
        var result = "<table>";
        result+="<tr><th>序号</th><th>姓名</th><th>难度</th><th>步数</th></tr>"
        //console.log(ret[i].ids);
        for(var i = 0;i<ret.length;i++){
          result+="<tr><td>"+ret[i].ids+"</td><td>"+ret[i].name+"</td><td>"+ret[i].rows+"</td><td>"+ret[i].times+"<td></tr>";
        }
        list.innerHTML=result;
      }else{
        list.innerHTML="数据为空，赶紧挑战吧";
      }

    });
  //  db.close();
  }
</script>

<title>Ink Transition Effect | CodyHouse</title>
</head>

<body>
<main class="cd-main-content">
	<div class="center">
		<a href="#0" class="cd-btn cd-modal-trigger">点击试试</a><br><br><br>


	</div>
</main> <!-- .cd-main-content -->

<div class="cd-modal" >
	<div class="modal-content">
<table width="715" height="142" border="1" align="center" >
<table width="715" height="142" border="1" align="center">
<tr>
    <td height="50"><table width="709" height="46" border="1" bordercolor = "white">
      <tr>
        <td width="41">总数</td>
        <td width="48" id="count">&nbsp;</td>
        <td width="59">点亮数</td>
        <td width="52" id="lian">&nbsp;</td>
        <td width="71">未点亮数</td>
        <td width="45" id="bu">&nbsp;</td>
        <td width="59">点击数</td>
        <td width="46" id="sum">&nbsp;</td>

        <td width="219">难度
          <input name="size" type="text" id="size" size="5" />
          (3-10)
          <input type="button" name="start" id="button" value="开始" onclick="init()" /></td>
					<td width = "50" id = "inputname">姓名
						<input name = "name" type = "text" id = "name" size = "5"/>
					</td>

      </tr>
    </table></td>
  </tr>

  <tr>
    <td><div id="tb"></div></td>
  </tr>

  <tr>
    <td height="25">游戏提示：将所有方格都变成红色即可胜利
      <br/><br/>
      <input type = "button" name = "button" value = "显示排行榜" onclick="loadall()"/>

      <br/>
      <input type="checkbox" id="onlyme">
      是否只显示指定用户(右上角输入姓名)

      <br/>
        <input type="checkbox" id="sort_by_times">
        按步数排序(默认按难度排序)
        <br/>
    </td>
    <td> </td>
  </tr>
</table>
<form action="http://127.0.0.1:8081/process_get" method="GET">
  Name:  <input type="text" name="name" id = "subname" disabled = "true">  <br>
  rows:   <input type="text" name="rows" id = "subrows" disabled = "true"> <br>
  times: <input type = "int" name="times" id = "subtimes" disabled = "true" >
  <input type="submit" value="Submit">
</form>
<div id = "list">


</div>
	</div> <!-- .modal-content -->

	<a href="#0" class="modal-close">Close</a>
</div>
<!-- .cd-modal -->

<div class="cd-transition-layer">
	<div class="bg-layer"></div>
</div> <!-- .cd-transition-layer -->


<script src="js/main.js"></script> <!-- Resource jQuery -->
</body>
</html>
